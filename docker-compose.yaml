version: "3.9"
services:
  coraza:
    build: .
    volumes:
      - type: bind
        source: ./docker/coraza-spoa
        target: /etc/coraza-spoa
  haproxy:
    image: haproxy:2.5.7-bullseye
    ports: [ "4000:80", "4443:443", "4001:4001" ]
    links:
      - "coraza:coraza"
      - "mockserv:mockserv"
    volumes:
      - type: bind
        source: ./docker/haproxy
        target: /usr/local/etc/haproxy
  mockserv:
    image: golang:1.18-bullseye
    command: go run /mockserv.go
    volumes:
      - type: bind
        source: ./contrib/mockserv.go
        target: /mockserv.go
